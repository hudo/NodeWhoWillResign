{"filter":false,"title":"utilities.js","tooltip":"/utils/utilities.js","undoManager":{"mark":24,"position":24,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":19,"column":1},"action":"insert","lines":["var urlParse = require('url').parse;","var slug = require('slug');","var path = require('path');","","module.exports.urlToFilename = function urlToFilename(url) {","  var parsedUrl = urlParse(url);","  var urlPath = parsedUrl.path.split('/')","    .filter(function(component) {","      return component !== '';","    })","    .map(function(component) {","      return slug(component);","    })","    .join('/');","  var filename = path.join(parsedUrl.hostname, urlPath);","  if(!path.extname(filename).match(/htm/)) {","    filename += '.html';","  }","  return filename;","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":19,"column":1},"action":"remove","lines":["var urlParse = require('url').parse;","var slug = require('slug');","var path = require('path');","","module.exports.urlToFilename = function urlToFilename(url) {","  var parsedUrl = urlParse(url);","  var urlPath = parsedUrl.path.split('/')","    .filter(function(component) {","      return component !== '';","    })","    .map(function(component) {","      return slug(component);","    })","    .join('/');","  var filename = path.join(parsedUrl.hostname, urlPath);","  if(!path.extname(filename).match(/htm/)) {","    filename += '.html';","  }","  return filename;","}"]},{"start":{"row":0,"column":0},"end":{"row":45,"column":1},"action":"insert","lines":["var urlParse = require('url').parse;","var urlFormat = require('url').format;","var urlResolve = require('url').resolve;","var slug = require('slug');","var path = require('path');","var cheerio = require('cheerio');","","module.exports.urlToFilename = function urlToFilename(url) {","  var parsedUrl = urlParse(url);","  var urlPath = parsedUrl.path.split('/')","    .filter(function(component) {","      return !!component;","    })","    .map(function(component) {","      return slug(component);","    })","    .join('/');","  var filename = path.join(parsedUrl.hostname, urlPath);","  if(!path.extname(filename).match(/htm/)) {","    filename += '.html';","  }","  return filename;","}","","","module.exports.getLinkUrl = function getLinkUrl(currentUrl, element) {","  var link = urlResolve(currentUrl, element.attribs.href || \"\");","  var parsedLink = urlParse(link);","  var currentParsedUrl = urlParse(currentUrl);","  if(parsedLink.hostname !== currentParsedUrl.hostname","    || !parsedLink.pathname) {","      return null;","  }","  return link;","}","","","module.exports.getPageLinks = function getPageLinks(currentUrl, body) {","  return [].slice.call(cheerio.load(body)('a'))","    .map(function(element) {","      return module.exports.getLinkUrl(currentUrl, element);","    })","    .filter(function(element) {","      return !!element;","    });","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":1,"column":38},"action":"remove","lines":["var urlFormat = require('url').format;"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":36},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":1},"end":{"row":21,"column":2},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":1},"end":{"row":33,"column":2},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":1},"end":{"row":44,"column":2},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":71},"end":{"row":37,"column":0},"action":"insert","lines":["",""]},{"start":{"row":37,"column":0},"end":{"row":37,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":2},"end":{"row":37,"column":3},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":3},"end":{"row":37,"column":4},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":4},"end":{"row":37,"column":5},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":5},"end":{"row":37,"column":6},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":6},"end":{"row":37,"column":7},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":2},"end":{"row":37,"column":7},"action":"remove","lines":["conso"]},{"start":{"row":37,"column":2},"end":{"row":37,"column":9},"action":"insert","lines":["console"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":9},"end":{"row":37,"column":10},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":10},"end":{"row":37,"column":11},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":11},"end":{"row":37,"column":12},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":10},"end":{"row":37,"column":12},"action":"remove","lines":["lo"]},{"start":{"row":37,"column":10},"end":{"row":37,"column":15},"action":"insert","lines":["log()"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":14},"end":{"row":37,"column":15},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":16},"end":{"row":37,"column":17},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":17},"end":{"row":37,"column":18},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":19},"end":{"row":37,"column":20},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":2},"end":{"row":37,"column":20},"action":"remove","lines":["console.log(body);"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":2},"end":{"row":38,"column":2},"action":"remove","lines":["","  "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":44,"column":2},"action":"remove","lines":["var urlParse = require('url').parse;","var urlResolve = require('url').resolve;","var slug = require('slug');","var path = require('path');","var cheerio = require('cheerio');","","module.exports.urlToFilename = function urlToFilename(url) {","  var parsedUrl = urlParse(url);","  var urlPath = parsedUrl.path.split('/')","    .filter(function(component) {","      return !!component;","    })","    .map(function(component) {","      return slug(component);","    })","    .join('/');","  var filename = path.join(parsedUrl.hostname, urlPath);","  if(!path.extname(filename).match(/htm/)) {","    filename += '.html';","  }","  return filename;","};","","","module.exports.getLinkUrl = function getLinkUrl(currentUrl, element) {","  var link = urlResolve(currentUrl, element.attribs.href || \"\");","  var parsedLink = urlParse(link);","  var currentParsedUrl = urlParse(currentUrl);","  if(parsedLink.hostname !== currentParsedUrl.hostname","    || !parsedLink.pathname) {","      return null;","  }","  return link;","};","","","module.exports.getPageLinks = function getPageLinks(currentUrl, body) {","  return [].slice.call(cheerio.load(body)('a'))","    .map(function(element) {","      return module.exports.getLinkUrl(currentUrl, element);","    })","    .filter(function(element) {","      return !!element;","    });","};"]},{"start":{"row":0,"column":0},"end":{"row":78,"column":3},"action":"insert","lines":["var request = require('request');","var fs = require('fs');","var mkdirp = require('mkdirp');","var path = require('path');","var utilities = require('./utilities');","","function spiderLinks(currentUrl, body, nesting, callback) {","  if(nesting === 0) {","    return process.nextTick(callback);","  }","  var links = utilities.getPageLinks(currentUrl, body);","  function iterate(index) {","    if(index === links.length) {","      return callback();","    }","   ","    spider(links[index], nesting - 1, function(err) {","      if(err) {","        return callback(err);","      }","      iterate(index + 1);","    });","  }","  iterate(0);","}","","function saveFile(filename, contents, callback) {","  mkdirp(path.dirname(filename), function(err) {","    if(err) {","      return callback(err);","    }","    fs.writeFile(filename, contents, callback);","  });","}","","function download(url, filename, callback) {","  console.log('Downloading ' + url);","  request(url, function(err, response, body) {","    if(err) {","      return callback(err);","    }","    saveFile(filename, body, function(err) {","      console.log('Downloaded and saved: ' + url);","      if(err) {","        return callback(err);","      }","      callback(null, body);","    });","  });  ","}","","function spider(url, nesting, callback) {","  var filename = utilities.urlToFilename(url);","  fs.readFile(filename, 'utf8', function(err, body) {","    if(err) {","      if(err.code !== 'ENOENT') {","        return callback(err);","      }","      ","      return download(url, filename, function(err, body) {","        if(err) {","          return callback(err);","        }","        spiderLinks(url, body, nesting, callback);","      });","    }","    ","    spiderLinks(url, body, nesting, callback);","  });","}","","","spider(process.argv[2], 1, function(err, filename) {","  if(err) {","    console.log(err);","  } else {","    console.log('Download complete');","  }","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":24},"end":{"row":72,"column":25},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":24},"end":{"row":72,"column":39},"action":"insert","lines":["process.argv[2]"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":37},"end":{"row":72,"column":38},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":37},"end":{"row":72,"column":38},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":4},"end":{"row":7,"column":5},"action":"insert","lines":[" "]},{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"insert","lines":["",""]},{"start":{"row":13,"column":6},"end":{"row":13,"column":7},"action":"insert","lines":[" "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":3},"action":"remove","lines":["   "]},{"start":{"row":18,"column":8},"end":{"row":18,"column":9},"action":"insert","lines":[" "]},{"start":{"row":29,"column":6},"end":{"row":29,"column":7},"action":"insert","lines":[" "]},{"start":{"row":39,"column":6},"end":{"row":39,"column":7},"action":"insert","lines":[" "]},{"start":{"row":44,"column":8},"end":{"row":44,"column":9},"action":"insert","lines":[" "]},{"start":{"row":49,"column":5},"end":{"row":49,"column":7},"action":"remove","lines":["  "]},{"start":{"row":55,"column":6},"end":{"row":55,"column":7},"action":"insert","lines":[" "]},{"start":{"row":56,"column":8},"end":{"row":56,"column":9},"action":"insert","lines":[" "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":6},"action":"remove","lines":["      "]},{"start":{"row":61,"column":10},"end":{"row":61,"column":11},"action":"insert","lines":[" "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":4},"action":"remove","lines":["    "]},{"start":{"row":74,"column":4},"end":{"row":74,"column":5},"action":"insert","lines":[" "]},{"start":{"row":76,"column":3},"end":{"row":77,"column":1},"action":"insert","lines":[""," "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":3},"end":{"row":10,"column":0},"action":"insert","lines":["",""]},{"start":{"row":10,"column":0},"end":{"row":10,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":10,"column":4},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":10,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":0},"end":{"row":10,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":3},"end":{"row":10,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":19,"column":3},"end":{"row":19,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1427200040778,"hash":"1eaf5b5b4c1d28bf9777361c57a5ea422b06e075"}